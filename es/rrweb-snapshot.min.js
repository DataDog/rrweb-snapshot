var NodeType;!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));var _id=1,tagNameRegex=RegExp("[^a-z1-6-_]"),IGNORED_NODE=-2;function genId(){return _id++}function getValidTagName(e){var t=e.toLowerCase().trim();return tagNameRegex.test(t)?"div":t}function getCssRulesString(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).map(getCssRuleString).join(""):null}catch(e){return null}}function getCssRuleString(e){return isCSSImportRule(e)?getCssRulesString(e.styleSheet)||"":e.cssText}function isCSSImportRule(e){return"styleSheet"in e}function extractOrigin(e){return(e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]}var URL_IN_CSS_REF=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,RELATIVE_PATH=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/).*/,DATA_URI=/^(data:)([\w\/\+\-]+);(charset=[\w-]+|base64|utf-?8).*,(.*)/i;function absoluteToStylesheet(e,t){return(e||"").replace(URL_IN_CSS_REF,function(e,r,n,i,a,o){var s=n||a||o,u=r||i||"";if(!s)return e;if(!RELATIVE_PATH.test(s))return"url("+u+s+u+")";if(DATA_URI.test(s))return"url("+u+s+u+")";if("/"===s[0])return"url("+u+(extractOrigin(t)+s)+u+")";var l=t.split("/"),c=s.split("/");l.pop();for(var f=0,d=c;f<d.length;f++){var m=d[f];"."!==m&&(".."===m?l.pop():l.push(m))}return"url("+u+l.join("/")+u+")"})}function getAbsoluteSrcsetString(e,t){return""===t.trim()?t:t.split(",").map(function(t){var r=t.trimLeft().trimRight().split(" ");return 2===r.length?absoluteToDoc(e,r[0])+" "+r[1]:1===r.length?""+absoluteToDoc(e,r[0]):""}).join(", ")}function absoluteToDoc(e,t){if(!t||""===t.trim())return t;var r=e.createElement("a");return r.href=t,r.href}function isSVGElement(e){return"svg"===e.tagName||e instanceof SVGElement}function transformAttribute(e,t,r){return"src"===t||"href"===t&&r?absoluteToDoc(e,r):"srcset"===t&&r?getAbsoluteSrcsetString(e,r):"style"===t&&r?absoluteToStylesheet(r,location.href):r}function _isBlockedElement(e,t,r){if("string"==typeof t){if(e.classList.contains(t))return!0}else e.classList.forEach(function(e){if(t.test(e))return!0});return!!r&&e.matches(r)}function serializeNode(e,t,r,n,i,a,o){var s;if(void 0===a&&(a={}),t.__sn){var u=t.__sn.id;s=1===u?void 0:u}switch(e.nodeType){case e.DOCUMENT_NODE:return{type:NodeType.Document,childNodes:[],rootId:s};case e.DOCUMENT_TYPE_NODE:return{type:NodeType.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:s};case e.ELEMENT_NODE:for(var l=_isBlockedElement(e,r,n),c=getValidTagName(e.tagName),f={},d=0,m=Array.from(e.attributes);d<m.length;d++){var p=m[d],h=p.name,g=p.value;f[h]=transformAttribute(t,h,g)}if("link"===c&&i){var v,y=Array.from(t.styleSheets).find(function(t){return t.href===e.href});(v=getCssRulesString(y))&&(delete f.rel,delete f.href,f._cssText=absoluteToStylesheet(v,y.href))}if("style"===c&&e.sheet&&!(e.innerText||e.textContent||"").trim().length)(v=getCssRulesString(e.sheet))&&(f._cssText=absoluteToStylesheet(v,location.href));if("input"===c||"textarea"===c||"select"===c){g=e.value;"radio"!==f.type&&"checkbox"!==f.type&&"submit"!==f.type&&"button"!==f.type&&g?f.value=a[f.type]||a[c]?"*".repeat(g.length):g:e.checked&&(f.checked=e.checked)}if("option"===c){var N=e.parentElement;f.value===N.value&&(f.selected=e.selected)}if("canvas"===c&&o&&(f.rr_dataURL=e.toDataURL()),"audio"!==c&&"video"!==c||(f.rr_mediaState=e.paused?"paused":"played"),e.scrollLeft&&(f.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(f.rr_scrollTop=e.scrollTop),l){var E=e.getBoundingClientRect(),b=E.width,T=E.height;f.rr_width=b+"px",f.rr_height=T+"px"}return{type:NodeType.Element,tagName:c,attributes:f,childNodes:[],isSVG:isSVGElement(e)||void 0,needBlock:l,rootId:s};case e.TEXT_NODE:var x=e.parentNode&&e.parentNode.tagName,w=e.textContent,I="STYLE"===x||void 0;return I&&w&&(w=absoluteToStylesheet(w,location.href)),"SCRIPT"===x&&(w="SCRIPT_PLACEHOLDER"),{type:NodeType.Text,textContent:w||"",isStyle:I,rootId:s};case e.CDATA_SECTION_NODE:return{type:NodeType.CDATA,textContent:"",rootId:s};case e.COMMENT_NODE:return{type:NodeType.Comment,textContent:e.textContent||"",rootId:s};default:return!1}}function lowerIfExists(e){return void 0===e?"":e.toLowerCase()}function slimDOMExcluded(e,t){if(t.comment&&e.type===NodeType.Comment)return!0;if(e.type===NodeType.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(lowerIfExists(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(e.attributes.name)||"icon"===lowerIfExists(e.attributes.rel)||"apple-touch-icon"===lowerIfExists(e.attributes.rel)||"shortcut icon"===lowerIfExists(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&lowerIfExists(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(lowerIfExists(e.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===lowerIfExists(e.attributes.name)||"googlebot"===lowerIfExists(e.attributes.name)||"bingbot"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===lowerIfExists(e.attributes.name)||"generator"===lowerIfExists(e.attributes.name)||"framework"===lowerIfExists(e.attributes.name)||"publisher"===lowerIfExists(e.attributes.name)||"progid"===lowerIfExists(e.attributes.name)||lowerIfExists(e.attributes.property).match(/^article:/)||lowerIfExists(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===lowerIfExists(e.attributes.name)||"yandex-verification"===lowerIfExists(e.attributes.name)||"csrf-token"===lowerIfExists(e.attributes.name)||"p:domain_verify"===lowerIfExists(e.attributes.name)||"verify-v1"===lowerIfExists(e.attributes.name)||"verification"===lowerIfExists(e.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(e.attributes.name)))return!0}}return!1}function serializeNodeWithId(e,t,r,n,i,a,o,s,u,l,c,f){void 0===a&&(a=!1),void 0===o&&(o=!0),void 0===u&&(u={}),void 0===c&&(c=!0);var d,m=serializeNode(e,t,n,i,o,s,l||!1);if(!m)return console.warn(e,"not serialized"),null;d="__sn"in e?e.__sn.id:slimDOMExcluded(m,u)||!c&&m.type===NodeType.Text&&!m.isStyle&&!m.textContent.replace(/^\s+|\s+$/gm,"").length?IGNORED_NODE:genId();var p=Object.assign(m,{id:d});if(e.__sn=p,d===IGNORED_NODE)return null;r[d]=e,f&&f(e);var h=!a;if(p.type===NodeType.Element&&(h=h&&!p.needBlock,delete p.needBlock),(p.type===NodeType.Document||p.type===NodeType.Element)&&h){u.headWhitespace&&m.type===NodeType.Element&&"head"==m.tagName&&(c=!1);for(var g=0,v=Array.from(e.childNodes);g<v.length;g++){var y=serializeNodeWithId(v[g],t,r,n,i,a,o,s,u,l,c);y&&p.childNodes.push(y)}}if(p.type===NodeType.Element&&"iframe"===p.tagName){var N=e.contentDocument;if(N){var E=serializeNodeWithId(N,N,r,n,i,!1,o,s,u,l);E&&p.childNodes.push(E)}}return p}function snapshot(e,t,r,n,i,a,o,s,u){void 0===t&&(t="rr-block"),void 0===r&&(r=!0),void 0===o&&(o=null);var l={};return[serializeNodeWithId(e,e,l,t,o,!1,r,!0===n?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===n?{}:n,!0===i||"all"===i?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===i,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===i?{}:i,a,s,u),l]}function visitSnapshot(e,t){!function e(r){t(r),r.type!==NodeType.Document&&r.type!==NodeType.Element||r.childNodes.forEach(e)}(e)}function cleanupSnapshot(){_id=1}var commentre=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function parse(e,t){void 0===t&&(t={});var r=1,n=1;function i(e){var t=e.match(/\n/g);t&&(r+=t.length);var i=e.lastIndexOf("\n");n=-1===i?n+e.length:e.length-i}function a(){var e={line:r,column:n};return function(t){return t.position=new o(e),m(),t}}var o=function(){return function(e){this.start=e,this.end={line:r,column:n},this.source=t.source}}();o.prototype.content=e;var s=[];function u(i){var a=new Error(t.source+":"+r+":"+n+": "+i);if(a.reason=i,a.filename=t.source,a.line=r,a.column=n,a.source=e,!t.silent)throw a;s.push(a)}function l(){return d(/^{\s*/)}function c(){return d(/^}/)}function f(){var t,r=[];for(m(),p(r);e.length&&"}"!==e.charAt(0)&&(t=I()||_());)!1!==t&&(r.push(t),p(r));return r}function d(t){var r=t.exec(e);if(r){var n=r[0];return i(n),e=e.slice(n.length),r}}function m(){d(/^\s*/)}function p(e){var t;for(void 0===e&&(e=[]);t=h();)!1!==t&&e.push(t),t=h();return e}function h(){var t=a();if("/"===e.charAt(0)&&"*"===e.charAt(1)){for(var r=2;""!==e.charAt(r)&&("*"!==e.charAt(r)||"/"!==e.charAt(r+1));)++r;if(r+=2,""===e.charAt(r-1))return u("End of comment missing");var o=e.slice(2,r-2);return n+=2,i(o),e=e.slice(r),n+=2,t({type:"comment",comment:o})}}function g(){var e=d(/^([^{]+)/);if(e)return trim(e[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(e){return e.replace(/,/g,"â€Œ")}).split(/\s*(?![^(]*\)),\s*/).map(function(e){return e.replace(/\u200C/g,",")})}function v(){var e=a(),t=d(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(t){var r=trim(t[0]);if(!d(/^:\s*/))return u("property missing ':'");var n=d(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),i=e({type:"declaration",property:r.replace(commentre,""),value:n?trim(n[0]).replace(commentre,""):""});return d(/^[;\s]*/),i}}function y(){var e,t=[];if(!l())return u("missing '{'");for(p(t);e=v();)!1!==e&&(t.push(e),p(t)),e=v();return c()?t:u("missing '}'")}function N(){for(var e,t=[],r=a();e=d(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)t.push(e[1]),d(/^,\s*/);if(t.length)return r({type:"keyframe",values:t,declarations:y()})}var E,b=w("import"),T=w("charset"),x=w("namespace");function w(e){var t=new RegExp("^@"+e+"\\s*([^;]+);");return function(){var r=a(),n=d(t);if(n){var i={type:e};return i[e]=n[1].trim(),r(i)}}}function I(){if("@"===e[0])return function(){var e=a(),t=d(/^@([-\w]+)?keyframes\s*/);if(t){var r=t[1];if(!(t=d(/^([-\w]+)\s*/)))return u("@keyframes missing name");var n,i=t[1];if(!l())return u("@keyframes missing '{'");for(var o=p();n=N();)o.push(n),o=o.concat(p());return c()?e({type:"keyframes",name:i,vendor:r,keyframes:o}):u("@keyframes missing '}'")}}()||function(){var e=a(),t=d(/^@media *([^{]+)/);if(t){var r=trim(t[1]);if(!l())return u("@media missing '{'");var n=p().concat(f());return c()?e({type:"media",media:r,rules:n}):u("@media missing '}'")}}()||function(){var e=a(),t=d(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(t)return e({type:"custom-media",name:trim(t[1]),media:trim(t[2])})}()||function(){var e=a(),t=d(/^@supports *([^{]+)/);if(t){var r=trim(t[1]);if(!l())return u("@supports missing '{'");var n=p().concat(f());return c()?e({type:"supports",supports:r,rules:n}):u("@supports missing '}'")}}()||b()||T()||x()||function(){var e=a(),t=d(/^@([-\w]+)?document *([^{]+)/);if(t){var r=trim(t[1]),n=trim(t[2]);if(!l())return u("@document missing '{'");var i=p().concat(f());return c()?e({type:"document",document:n,vendor:r,rules:i}):u("@document missing '}'")}}()||function(){var e=a();if(d(/^@page */)){var t=g()||[];if(!l())return u("@page missing '{'");for(var r,n=p();r=v();)n.push(r),n=n.concat(p());return c()?e({type:"page",selectors:t,declarations:n}):u("@page missing '}'")}}()||function(){var e=a();if(d(/^@host\s*/)){if(!l())return u("@host missing '{'");var t=p().concat(f());return c()?e({type:"host",rules:t}):u("@host missing '}'")}}()||function(){var e=a();if(d(/^@font-face\s*/)){if(!l())return u("@font-face missing '{'");for(var t,r=p();t=v();)r.push(t),r=r.concat(p());return c()?e({type:"font-face",declarations:r}):u("@font-face missing '}'")}}()}function _(){var e=a(),t=g();return t?(p(),e({type:"rule",selectors:t,declarations:y()})):u("selector missing")}return addParent((E=f(),{type:"stylesheet",stylesheet:{source:t.source,rules:E,parsingErrors:s}}))}function trim(e){return e?e.replace(/^\s+|\s+$/g,""):""}function addParent(e,t){for(var r=e&&"string"==typeof e.type,n=r?e:t,i=0,a=Object.keys(e);i<a.length;i++){var o=e[a[i]];Array.isArray(o)?o.forEach(function(e){addParent(e,n)}):o&&"object"==typeof o&&addParent(o,n)}return r&&Object.defineProperty(e,"parent",{configurable:!0,writable:!0,enumerable:!1,value:t||null}),e}var tagMap={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function getTagName(e){var t=tagMap[e.tagName]?tagMap[e.tagName]:e.tagName;return"link"===t&&e.attributes._cssText&&(t="style"),t}var HOVER_SELECTOR=/([^\\]):hover/g;function addHoverClass(e){var t=parse(e,{silent:!0});return t.stylesheet?(t.stylesheet.rules.forEach(function(t){"selectors"in t&&(t.selectors||[]).forEach(function(t){if(HOVER_SELECTOR.test(t)){var r=t.replace(HOVER_SELECTOR,"$1.\\:hover");e=e.replace(t,t+", "+r)}})}),e):e}function isIframe(e){return e.type===NodeType.Element&&"iframe"===e.tagName}function buildIframe(e,t,r,n,i){for(var a=e.contentDocument,o=0,s=t;o<s.length;o++){var u=s[o];console.log("build iframe",u),buildNodeWithSN(u,a,r,n,!1,i)}}function buildNode(e,t,r){switch(e.type){case NodeType.Document:return t.implementation.createDocument(null,"",null);case NodeType.DocumentType:return t.implementation.createDocumentType(e.name||"html",e.publicId,e.systemId);case NodeType.Element:var n,i=getTagName(e);n=e.isSVG?t.createElementNS("http://www.w3.org/2000/svg",i):t.createElement(i);var a=function(a){if(!e.attributes.hasOwnProperty(a))return"continue";var o=e.attributes[a];if(o="boolean"==typeof o||"number"==typeof o?"":o,a.startsWith("rr_")){if("canvas"===i&&"rr_dataURL"===a){var s=document.createElement("img");s.src=o,s.onload=function(){var e=n.getContext("2d");e&&e.drawImage(s,0,0,s.width,s.height)}}if("rr_width"===a&&(n.style.width=o),"rr_height"===a&&(n.style.height=o),"rr_mediaState"===a)switch(o){case"played":n.play();case"paused":n.pause()}}else{var u="textarea"===i&&"value"===a,l="style"===i&&"_cssText"===a;if(l&&r&&(o=addHoverClass(o)),u||l){for(var c=t.createTextNode(o),f=0,d=Array.from(n.childNodes);f<d.length;f++){var m=d[f];m.nodeType===n.TEXT_NODE&&n.removeChild(m)}return n.appendChild(c),"continue"}if("iframe"===i&&"src"===a)return"continue";try{e.isSVG&&"xlink:href"===a?n.setAttributeNS("http://www.w3.org/1999/xlink",a,o):"onload"===a||"onclick"===a||"onmouse"===a.substring(0,7)?n.setAttribute("_"+a,o):n.setAttribute(a,o)}catch(e){}}};for(var o in e.attributes)a(o);return n;case NodeType.Text:return t.createTextNode(e.isStyle&&r?addHoverClass(e.textContent):e.textContent);case NodeType.CDATA:return t.createCDATASection(e.textContent);case NodeType.Comment:return t.createComment(e.textContent);default:return null}}function buildNodeWithSN(e,t,r,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0);var o=buildNode(e,t,a);if(!o)return[null,[]];e.rootId&&console.assert(r[e.rootId]===t,"Target document should has the same root id."),e.type===NodeType.Document&&(t.close(),t.open(),o=t),o.__sn=e,r[e.id]=o;var s=isIframe(e);if(e.type===NodeType.Element&&s)return[o,e.childNodes];if((e.type===NodeType.Document||e.type===NodeType.Element)&&!i)for(var u=function(e){var i=buildNodeWithSN(e,t,r,n,!1,a),s=i[0],u=i[1];return s?(o.appendChild(s),0===u.length?"continue":void(isIframe(e)&&n.push(function(){return buildIframe(s,u,r,n,a)}))):(console.warn("Failed to rebuild",e),"continue")},l=0,c=e.childNodes;l<c.length;l++){u(c[l])}return[o,[]]}function visit(e,t){for(var r in e)e[r]&&(n=e[r],t(n));var n}function handleScroll(e){var t=e.__sn;if(t.type===NodeType.Element){var r=e;for(var n in t.attributes)if(t.attributes.hasOwnProperty(n)&&n.startsWith("rr_")){var i=t.attributes[n];"rr_scrollLeft"===n&&(r.scrollLeft=i),"rr_scrollTop"===n&&(r.scrollTop=i)}}}function rebuild(e,t,r,n){void 0===n&&(n=!0);var i={},a=[],o=buildNodeWithSN(e,t,i,a,!1,n)[0];return a.forEach(function(e){return e()}),visit(i,function(e){r&&r(e),handleScroll(e)}),[o,i]}export{snapshot,serializeNodeWithId,rebuild,buildNodeWithSN,addHoverClass,transformAttribute,visitSnapshot,cleanupSnapshot,IGNORED_NODE,NodeType};
//# sourceMappingURL=rrweb-snapshot.min.js.map
